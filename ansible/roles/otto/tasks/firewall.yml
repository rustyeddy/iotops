---
# Firewall configuration tasks for Otto

- name: Check if firewalld is installed
  stat:
    path: /usr/bin/firewalld
  register: firewalld_check
  tags: firewall

- name: Configure firewalld for Otto
  firewalld:
    port: "{{ item }}"
    permanent: yes
    state: enabled
    immediate: yes
  loop: "{{ otto_firewall_ports }}"
  when: firewalld_check.stat.exists
  tags: firewall

- name: Check if ufw is installed
  stat:
    path: /usr/sbin/ufw
  register: ufw_check
  tags: firewall

- name: Configure ufw for Otto
  ufw:
    rule: allow
    port: "{{ item.split('/')[0] }}"
    proto: "{{ item.split('/')[1] }}"
  loop: "{{ otto_firewall_ports }}"
  when: ufw_check.stat.exists and '/' in item
  tags: firewall
